# SSO UserCache Schema - User model for SSO integration
# Contains basic user info (cached from Console) and SSO fields

kind: object

displayName:
  ja: ユーザーキャッシュ
  en: User Cache
  vi: Cache Người dùng

options:
  timestamps: true
  idType: Uuid

properties:
  # Basic user info (cached from Console)
  name:
    type: String
    displayName:
      ja: 名前
      en: Name
      vi: Tên

  email:
    type: String
    unique: true
    displayName:
      ja: メールアドレス
      en: Email
      vi: Email

  # SSO fields
  console_user_id:
    type: Uuid
    unique: true
    nullable: true
    displayName:
      ja: Console User ID
      en: Console User ID
      vi: Console User ID
    description:
      ja: Console側のユーザーID
      en: User ID from Console SSO
      vi: ID người dùng từ Console SSO

  console_access_token:
    type: Text
    nullable: true
    displayName:
      ja: Console Access Token
      en: Console Access Token
      vi: Console Access Token
    description:
      ja: Console APIアクセス用トークン（暗号化）
      en: Encrypted token for Console API access
      vi: Token mã hóa để truy cập Console API

  console_refresh_token:
    type: Text
    nullable: true
    displayName:
      ja: Console Refresh Token
      en: Console Refresh Token
      vi: Console Refresh Token
    description:
      ja: トークン更新用リフレッシュトークン（暗号化）
      en: Encrypted refresh token for token renewal
      vi: Token làm mới mã hóa

  console_token_expires_at:
    type: Timestamp
    nullable: true
    displayName:
      ja: Console Token有効期限
      en: Console Token Expiry
      vi: Hạn Token Console
    description:
      ja: アクセストークンの有効期限
      en: Access token expiration time
      vi: Thời gian hết hạn của token truy cập

  roles:
    type: Association
    relation: ManyToMany
    target: Role
    joinTable: role_user_cache
    owning: true
    displayName:
      ja: ロール
      en: Roles
      vi: Vai trò
    description:
      ja: ユーザーのロール（複数可、スコープ指定可能）
      en: User's roles (multiple allowed, can be scoped to org/branch)
      vi: Vai trò của người dùng (có thể nhiều, có thể giới hạn theo org/branch)
    # Pivot fields for scoped role assignments (Option B - Industry Standard)
    # See: NIST RBAC, WorkOS, Salesforce patterns
    # Note: Using String(36) for UUID storage since Omnify pivotFields doesn't support Uuid type yet
    # Actual migration uses uuid() column type - see database/migrations/0001_01_01_000001_create_sso_tables.php
    pivotFields:
      console_org_id:
        type: String
        length: 36
        nullable: true
        displayName:
          ja: 組織ID
          en: Organization ID
          vi: ID tổ chức
        description:
          ja: nullの場合はシステム全体に適用（グローバルスコープ）
          en: null means system-wide assignment (global scope)
          vi: null nghĩa là áp dụng toàn hệ thống (phạm vi toàn cục)
      console_branch_id:
        type: String
        length: 36
        nullable: true
        displayName:
          ja: ブランチID
          en: Branch ID
          vi: ID chi nhánh
        description:
          ja: nullの場合は組織全体に適用（組織スコープ）。指定した場合は該当ブランチのみ（ブランチスコープ）
          en: null means org-wide assignment. When specified, applies only to that branch (branch scope)
          vi: null nghĩa là áp dụng toàn tổ chức. Khi chỉ định, chỉ áp dụng cho chi nhánh đó (phạm vi chi nhánh)
