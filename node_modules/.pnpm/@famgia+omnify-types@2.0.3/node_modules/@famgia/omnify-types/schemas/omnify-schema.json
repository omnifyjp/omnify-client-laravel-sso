{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://omnify.dev/schemas/omnify-schema.json",
  "title": "Omnify Schema Definition",
  "description": "Schema definition for Omnify - a database-first schema generator for Laravel, TypeScript, and more.",
  "type": "object",
  "properties": {
    "name": {
      "type": "string",
      "description": "Schema name (usually derived from filename, but can be specified explicitly)"
    },
    "kind": {
      "type": "string",
      "enum": [
        "object",
        "enum",
        "partial"
      ],
      "default": "object",
      "description": "Schema kind - 'object' for database tables, 'enum' for enumeration types, 'partial' for extending existing schemas"
    },
    "target": {
      "type": "string",
      "description": "Target schema name for partial schemas (only used when kind is 'partial'). The partial schema's properties will be merged into the target."
    },
    "displayName": {
      "$ref": "#/definitions/LocalizedString",
      "description": "Human-readable display name (supports multi-language)"
    },
    "titleIndex": {
      "type": "string",
      "description": "Property to use as the title/label for records (e.g., 'name', 'title')"
    },
    "group": {
      "type": "string",
      "description": "Schema group for organization (e.g., 'auth', 'blog', 'shop')"
    },
    "options": {
      "$ref": "#/definitions/SchemaOptions"
    },
    "properties": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/PropertyDefinition"
      },
      "description": "Property definitions for this schema"
    },
    "values": {
      "type": "array",
      "items": {
        "oneOf": [
          {
            "type": "string"
          },
          {
            "$ref": "#/definitions/EnumValue"
          }
        ]
      },
      "description": "Enum values (only when kind is 'enum')"
    }
  },
  "definitions": {
    "LocalizedString": {
      "oneOf": [
        {
          "type": "string"
        },
        {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Locale map (e.g., { ja: '日本語', en: 'English', vi: 'Tiếng Việt' })"
        }
      ],
      "description": "A string or locale map for multi-language support"
    },
    "SchemaOptions": {
      "type": "object",
      "properties": {
        "id": {
          "type": "boolean",
          "default": true,
          "description": "Whether to auto-generate an 'id' primary key column"
        },
        "idType": {
          "type": "string",
          "enum": [
            "BigInt",
            "Int",
            "Uuid",
            "String"
          ],
          "default": "BigInt",
          "description": "Type of the auto-generated 'id' column"
        },
        "timestamps": {
          "type": "boolean",
          "default": true,
          "description": "Add created_at and updated_at timestamp columns"
        },
        "softDelete": {
          "type": "boolean",
          "default": false,
          "description": "Add deleted_at column for soft deletes"
        },
        "tableName": {
          "type": "string",
          "description": "Custom table name (defaults to pluralized snake_case of schema name)"
        },
        "authenticatable": {
          "type": "boolean",
          "default": false,
          "description": "Enable authenticatable trait (for User-like schemas)"
        },
        "indexes": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/IndexDefinition"
          },
          "description": "Database indexes for query optimization"
        },
        "hidden": {
          "type": "boolean",
          "default": false,
          "description": "Hide from model generation (migrations still generated, but no Laravel/TypeScript models)"
        }
      }
    },
    "IndexDefinition": {
      "type": "object",
      "required": [
        "columns"
      ],
      "properties": {
        "columns": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Columns to include in the index"
        },
        "unique": {
          "type": "boolean",
          "default": false,
          "description": "Whether this is a unique index"
        },
        "name": {
          "type": "string",
          "description": "Custom index name"
        },
        "type": {
          "type": "string",
          "enum": [
            "btree",
            "hash",
            "fulltext",
            "spatial",
            "gin",
            "gist"
          ],
          "description": "Index type"
        }
      }
    },
    "PropertyDefinition": {
      "oneOf": [
        {
          "$ref": "#/definitions/StringProperty"
        },
        {
          "$ref": "#/definitions/NumericProperty"
        },
        {
          "$ref": "#/definitions/BooleanProperty"
        },
        {
          "$ref": "#/definitions/TextProperty"
        },
        {
          "$ref": "#/definitions/DateTimeProperty"
        },
        {
          "$ref": "#/definitions/TimestampProperty"
        },
        {
          "$ref": "#/definitions/JsonProperty"
        },
        {
          "$ref": "#/definitions/EnumProperty"
        },
        {
          "$ref": "#/definitions/EnumRefProperty"
        },
        {
          "$ref": "#/definitions/FileProperty"
        },
        {
          "$ref": "#/definitions/AssociationProperty"
        }
      ]
    },
    "ValidationRules": {
      "type": "object",
      "description": "Validation rules (application-level only, NOT database structure). Each rule is only valid for specific types.",
      "properties": {
        "required": {
          "type": "boolean",
          "default": false,
          "description": "[All types] Whether the field is required. Does NOT affect database nullable."
        },
        "minLength": {
          "type": "integer",
          "minimum": 0,
          "description": "[String types only] Minimum length validation."
        },
        "maxLength": {
          "type": "integer",
          "minimum": 1,
          "description": "[String types only] Maximum length validation. Must be <= 'length' (database size)."
        },
        "url": {
          "type": "boolean",
          "description": "[String types only] Must be a valid URL. → z.url()"
        },
        "uuid": {
          "type": "boolean",
          "description": "[String types only] Must be a valid UUID. → z.uuid()"
        },
        "ip": {
          "type": "boolean",
          "description": "[String types only] Must be a valid IP address (v4 or v6). → z.ip()"
        },
        "ipv4": {
          "type": "boolean",
          "description": "[String types only] Must be a valid IPv4 address. → z.ipv4()"
        },
        "ipv6": {
          "type": "boolean",
          "description": "[String types only] Must be a valid IPv6 address. → z.ipv6()"
        },
        "alpha": {
          "type": "boolean",
          "description": "[String types only] Only alphabetic characters (a-z, A-Z)."
        },
        "alphaNum": {
          "type": "boolean",
          "description": "[String types only] Only alphanumeric characters (a-z, A-Z, 0-9)."
        },
        "alphaDash": {
          "type": "boolean",
          "description": "[String types only] Only alphanumeric, dash, underscore (a-z, A-Z, 0-9, -, _)."
        },
        "numeric": {
          "type": "boolean",
          "description": "[String types only] Only numeric characters (0-9)."
        },
        "digits": {
          "type": "integer",
          "minimum": 1,
          "description": "[String types only] Must be exactly n digits."
        },
        "digitsBetween": {
          "type": "array",
          "items": {
            "type": "integer"
          },
          "minItems": 2,
          "maxItems": 2,
          "description": "[String types only] Must be between min and max digits. Format: [min, max]"
        },
        "startsWith": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          ],
          "description": "[String types only] Must start with prefix(es)."
        },
        "endsWith": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          ],
          "description": "[String types only] Must end with suffix(es)."
        },
        "lowercase": {
          "type": "boolean",
          "description": "[String types only] Must be entirely lowercase."
        },
        "uppercase": {
          "type": "boolean",
          "description": "[String types only] Must be entirely uppercase."
        },
        "min": {
          "type": "number",
          "description": "[Numeric types only] Minimum value (inclusive). → .gte(n)"
        },
        "max": {
          "type": "number",
          "description": "[Numeric types only] Maximum value (inclusive). → .lte(n)"
        },
        "between": {
          "type": "array",
          "items": {
            "type": "number"
          },
          "minItems": 2,
          "maxItems": 2,
          "description": "[Numeric types only] Must be between min and max. Format: [min, max]"
        },
        "gt": {
          "type": "number",
          "description": "[Numeric types only] Must be greater than value. → .gt(n)"
        },
        "lt": {
          "type": "number",
          "description": "[Numeric types only] Must be less than value. → .lt(n)"
        },
        "multipleOf": {
          "type": "number",
          "exclusiveMinimum": 0,
          "description": "[Numeric types only] Must be a multiple of value. → .multipleOf(n)"
        },
        "arrayMin": {
          "type": "integer",
          "minimum": 0,
          "description": "[Array types only] Minimum number of items."
        },
        "arrayMax": {
          "type": "integer",
          "minimum": 1,
          "description": "[Array types only] Maximum number of items."
        }
      }
    },
    "BaseProperty": {
      "type": "object",
      "properties": {
        "displayName": {
          "$ref": "#/definitions/LocalizedString",
          "description": "Human-readable display name (supports multi-language)"
        },
        "description": {
          "$ref": "#/definitions/LocalizedString",
          "description": "Field description/comment"
        },
        "placeholder": {
          "$ref": "#/definitions/LocalizedString",
          "description": "Placeholder text for form inputs (supports multi-language)"
        },
        "nullable": {
          "type": "boolean",
          "default": false,
          "description": "Whether the field can be null in database"
        },
        "unique": {
          "type": "boolean",
          "default": false,
          "description": "Whether this field must be unique"
        },
        "primary": {
          "type": "boolean",
          "default": false,
          "description": "Whether this field is the primary key. Use with options.id: false for tables with custom primary keys (e.g., cache tables)"
        },
        "default": {
          "description": "Default value for the field"
        },
        "rules": {
          "$ref": "#/definitions/ValidationRules",
          "description": "Validation rules (application-level only, NOT database)"
        },
        "hidden": {
          "type": "boolean",
          "default": false,
          "description": "Whether this field should be hidden in API responses/serialization"
        },
        "fillable": {
          "type": "boolean",
          "default": true,
          "description": "Whether this field is mass assignable (Laravel)"
        },
        "fields": {
          "$ref": "#/definitions/CompoundFieldOverrides",
          "description": "Per-field settings for compound types (nullable, hidden, fillable, placeholder overrides)"
        }
      }
    },
    "CompoundFieldOverrides": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/CompoundFieldOverride"
      },
      "description": "Per-field overrides for compound types. Keys are field suffixes (e.g., 'Lastname', 'PostalCode')"
    },
    "CompoundFieldOverride": {
      "type": "object",
      "properties": {
        "nullable": {
          "type": "boolean",
          "description": "Override nullable for this field"
        },
        "hidden": {
          "type": "boolean",
          "description": "Override hidden for this field"
        },
        "fillable": {
          "type": "boolean",
          "description": "Override fillable for this field"
        },
        "length": {
          "type": "integer",
          "minimum": 1,
          "description": "Override length for string fields"
        },
        "displayName": {
          "$ref": "#/definitions/LocalizedString",
          "description": "Override display name (label) for this field (supports multi-language)"
        },
        "placeholder": {
          "$ref": "#/definitions/LocalizedString",
          "description": "Override placeholder for this field (supports multi-language)"
        }
      }
    },
    "StringProperty": {
      "allOf": [
        {
          "$ref": "#/definitions/BaseProperty"
        },
        {
          "type": "object",
          "required": [
            "type"
          ],
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "String",
                "Email",
                "Password"
              ],
              "description": "String type"
            },
            "length": {
              "type": "integer",
              "minimum": 1,
              "maximum": 65535,
              "default": 255,
              "description": "Database column size (NOT validation). Use rules.maxLength for validation."
            }
          }
        }
      ]
    },
    "NumericProperty": {
      "allOf": [
        {
          "$ref": "#/definitions/BaseProperty"
        },
        {
          "type": "object",
          "required": [
            "type"
          ],
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "TinyInt",
                "Int",
                "BigInt",
                "Float",
                "Decimal"
              ],
              "description": "Numeric type - TinyInt (8-bit), Int (32-bit), BigInt (64-bit)"
            },
            "unsigned": {
              "type": "boolean",
              "default": false,
              "description": "Whether the number is unsigned (positive only)"
            },
            "precision": {
              "type": "integer",
              "description": "Total number of digits for Decimal (default: 8)"
            },
            "scale": {
              "type": "integer",
              "description": "Number of decimal places for Decimal (default: 2)"
            }
          }
        }
      ]
    },
    "BooleanProperty": {
      "allOf": [
        {
          "$ref": "#/definitions/BaseProperty"
        },
        {
          "type": "object",
          "required": [
            "type"
          ],
          "properties": {
            "type": {
              "const": "Boolean",
              "description": "Boolean type"
            }
          }
        }
      ]
    },
    "TextProperty": {
      "allOf": [
        {
          "$ref": "#/definitions/BaseProperty"
        },
        {
          "type": "object",
          "required": [
            "type"
          ],
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "Text",
                "MediumText",
                "LongText"
              ],
              "description": "Text type - Text (~65KB), MediumText (~16MB), LongText (~4GB)"
            }
          }
        }
      ]
    },
    "DateTimeProperty": {
      "allOf": [
        {
          "$ref": "#/definitions/BaseProperty"
        },
        {
          "type": "object",
          "required": [
            "type"
          ],
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "Date",
                "DateTime",
                "Time"
              ],
              "description": "Date/Time type"
            }
          }
        }
      ]
    },
    "TimestampProperty": {
      "allOf": [
        {
          "$ref": "#/definitions/BaseProperty"
        },
        {
          "type": "object",
          "required": [
            "type"
          ],
          "properties": {
            "type": {
              "const": "Timestamp",
              "description": "Timestamp type"
            },
            "useCurrent": {
              "type": "boolean",
              "default": false,
              "description": "Use CURRENT_TIMESTAMP as default value (Laravel: useCurrent())"
            },
            "useCurrentOnUpdate": {
              "type": "boolean",
              "default": false,
              "description": "Update to CURRENT_TIMESTAMP on row update (Laravel: useCurrentOnUpdate())"
            }
          }
        }
      ]
    },
    "JsonProperty": {
      "allOf": [
        {
          "$ref": "#/definitions/BaseProperty"
        },
        {
          "type": "object",
          "required": [
            "type"
          ],
          "properties": {
            "type": {
              "const": "Json",
              "description": "JSON type for storing structured data"
            }
          }
        }
      ]
    },
    "EnumProperty": {
      "allOf": [
        {
          "$ref": "#/definitions/BaseProperty"
        },
        {
          "type": "object",
          "required": [
            "type",
            "enum"
          ],
          "properties": {
            "type": {
              "const": "Enum",
              "description": "Inline enum type"
            },
            "enum": {
              "type": "array",
              "items": {
                "oneOf": [
                  {
                    "type": "string"
                  },
                  {
                    "$ref": "#/definitions/EnumValue"
                  }
                ]
              },
              "description": "Inline enum values"
            }
          }
        }
      ]
    },
    "EnumRefProperty": {
      "allOf": [
        {
          "$ref": "#/definitions/BaseProperty"
        },
        {
          "type": "object",
          "required": [
            "type",
            "enum"
          ],
          "properties": {
            "type": {
              "const": "EnumRef",
              "description": "Reference to a shared enum schema"
            },
            "enum": {
              "type": "string",
              "description": "Name of the enum schema to reference"
            }
          }
        }
      ]
    },
    "EnumValue": {
      "type": "object",
      "required": [
        "value"
      ],
      "properties": {
        "value": {
          "type": "string",
          "description": "Enum value (stored in database)"
        },
        "label": {
          "$ref": "#/definitions/LocalizedString",
          "description": "Human-readable label (supports multi-language)"
        },
        "extra": {
          "type": "object",
          "description": "Additional metadata for the enum value"
        }
      }
    },
    "FileProperty": {
      "allOf": [
        {
          "$ref": "#/definitions/BaseProperty"
        },
        {
          "type": "object",
          "required": [
            "type"
          ],
          "properties": {
            "type": {
              "const": "File",
              "description": "File attachment (polymorphic relation)"
            },
            "multiple": {
              "type": "boolean",
              "default": false,
              "description": "Allow multiple files"
            },
            "maxFiles": {
              "type": "integer",
              "description": "Maximum number of files (only when multiple=true)"
            },
            "accept": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Accepted file extensions (e.g., ['jpg', 'png', 'pdf'])"
            },
            "maxSize": {
              "type": "integer",
              "description": "Maximum file size in KB"
            }
          }
        }
      ]
    },
    "AssociationProperty": {
      "type": "object",
      "required": [
        "type",
        "relation"
      ],
      "properties": {
        "type": {
          "const": "Association",
          "description": "Relationship to another schema"
        },
        "relation": {
          "type": "string",
          "enum": [
            "OneToOne",
            "OneToMany",
            "ManyToOne",
            "ManyToMany",
            "MorphTo",
            "MorphOne",
            "MorphMany",
            "MorphToMany",
            "MorphedByMany"
          ],
          "description": "Relationship cardinality type"
        },
        "target": {
          "type": "string",
          "description": "Target schema name (e.g., 'User', 'Post')"
        },
        "displayName": {
          "$ref": "#/definitions/LocalizedString",
          "description": "Human-readable display name"
        },
        "onDelete": {
          "type": "string",
          "enum": [
            "CASCADE",
            "SET NULL",
            "SET DEFAULT",
            "RESTRICT",
            "NO ACTION"
          ],
          "description": "Action when referenced record is deleted"
        },
        "onUpdate": {
          "type": "string",
          "enum": [
            "CASCADE",
            "SET NULL",
            "SET DEFAULT",
            "RESTRICT",
            "NO ACTION"
          ],
          "description": "Action when referenced record is updated"
        },
        "joinTable": {
          "type": "string",
          "description": "Custom join table name for ManyToMany"
        },
        "inversedBy": {
          "type": "string",
          "description": "Property name on target that maps back"
        },
        "mappedBy": {
          "type": "string",
          "description": "Property name that is mapped by target"
        },
        "targets": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Target schema names for MorphTo (e.g., ['Post', 'Video'])"
        },
        "morphName": {
          "type": "string",
          "description": "Custom morph name for polymorphic relations"
        },
        "nullable": {
          "type": "boolean",
          "default": true,
          "description": "Whether the relation columns are nullable (default: true for MorphTo)"
        }
      }
    }
  },
  "examples": [
    {
      "name": "User",
      "displayName": {
        "ja": "ユーザー",
        "en": "User"
      },
      "options": {
        "softDelete": true,
        "authenticatable": true
      },
      "properties": {
        "name": {
          "type": "String",
          "displayName": {
            "ja": "氏名",
            "en": "Full Name"
          }
        },
        "email": {
          "type": "Email",
          "unique": true,
          "displayName": {
            "ja": "メールアドレス",
            "en": "Email"
          }
        },
        "password": {
          "type": "Password"
        },
        "posts": {
          "type": "Association",
          "relation": "OneToMany",
          "target": "Post"
        }
      }
    },
    {
      "name": "Post",
      "displayName": {
        "ja": "投稿",
        "en": "Post"
      },
      "options": {
        "softDelete": true,
        "indexes": [
          {
            "columns": [
              "published_at"
            ]
          },
          {
            "columns": [
              "status",
              "published_at"
            ]
          }
        ]
      },
      "properties": {
        "title": {
          "type": "String",
          "displayName": {
            "ja": "タイトル",
            "en": "Title"
          }
        },
        "content": {
          "type": "LongText",
          "displayName": {
            "ja": "本文",
            "en": "Content"
          }
        },
        "status": {
          "type": "EnumRef",
          "enum": "PostStatus",
          "default": "draft"
        },
        "author": {
          "type": "Association",
          "relation": "ManyToOne",
          "target": "User",
          "onDelete": "CASCADE"
        }
      }
    },
    {
      "name": "PostStatus",
      "kind": "enum",
      "displayName": {
        "ja": "投稿ステータス",
        "en": "Post Status"
      },
      "values": [
        {
          "value": "draft",
          "label": {
            "ja": "下書き",
            "en": "Draft"
          }
        },
        {
          "value": "published",
          "label": {
            "ja": "公開済み",
            "en": "Published"
          }
        },
        {
          "value": "archived",
          "label": {
            "ja": "アーカイブ",
            "en": "Archived"
          }
        }
      ]
    },
    {
      "name": "Cache",
      "displayName": {
        "ja": "キャッシュ",
        "en": "Cache"
      },
      "options": {
        "id": false,
        "timestamps": false
      },
      "properties": {
        "key": {
          "type": "String",
          "primary": true,
          "displayName": {
            "ja": "キー",
            "en": "Key"
          }
        },
        "value": {
          "type": "Text",
          "displayName": {
            "ja": "値",
            "en": "Value"
          }
        },
        "expiration": {
          "type": "Int",
          "displayName": {
            "ja": "有効期限",
            "en": "Expiration"
          }
        }
      }
    },
    {
      "name": "UserBilling",
      "kind": "partial",
      "target": "User",
      "displayName": {
        "ja": "ユーザー請求情報",
        "en": "User Billing"
      },
      "properties": {
        "stripe_customer_id": {
          "type": "String",
          "nullable": true,
          "displayName": {
            "ja": "Stripe顧客ID",
            "en": "Stripe Customer ID"
          }
        },
        "subscription_status": {
          "type": "String",
          "nullable": true,
          "displayName": {
            "ja": "購読状態",
            "en": "Subscription Status"
          }
        }
      }
    }
  ]
}