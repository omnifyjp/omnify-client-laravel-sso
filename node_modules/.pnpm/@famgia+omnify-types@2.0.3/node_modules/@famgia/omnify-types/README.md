# @famgia/omnify-types

Shared TypeScript type definitions for the Omnify schema system.

## Installation

```bash
npm install @famgia/omnify-types
```

## Usage

```typescript
import type {
  // Schema types
  SchemaDefinition,
  LoadedSchema,
  SchemaCollection,
  PropertyDefinition,
  AssociationDefinition,

  // Plugin types
  OmnifyPlugin,
  PluginContext,
  PluginLogger,
  CustomTypeDefinition,

  // Generator types
  GeneratorDefinition,
  GeneratorContext,
  GeneratorOutput,
  GeneratorOutputType,

  // Config types
  OmnifyConfig,
  ResolvedOmnifyConfig,
} from '@famgia/omnify-types';
```

## Type Reference

### Schema Types

#### `SchemaDefinition`
Raw schema definition as loaded from YAML/JSON.

```typescript
interface SchemaDefinition {
  name: string;
  kind: 'object' | 'enum';
  displayName?: string;
  properties?: Record<string, PropertyDefinition>;
  associations?: Record<string, AssociationDefinition>;
  options?: SchemaOptions;
  values?: string[]; // For enums
}
```

#### `LoadedSchema`
Parsed and validated schema with file path.

```typescript
interface LoadedSchema extends SchemaDefinition {
  filePath: string;
}
```

#### `SchemaCollection`
Map of schema name to loaded schema.

```typescript
type SchemaCollection = Record<string, LoadedSchema>;
```

#### `PropertyDefinition`
Field/property definition.

```typescript
interface PropertyDefinition {
  type: string;
  nullable?: boolean;
  unique?: boolean;
  default?: unknown;
  displayName?: string;
}
```

#### `AssociationDefinition`
Relationship definition.

```typescript
interface AssociationDefinition {
  type: 'belongsTo' | 'hasMany' | 'hasOne' | 'belongsToMany';
  model: string;
  foreignKey?: string;
  pivotTable?: string;
}
```

### Plugin Types

#### `OmnifyPlugin`
Plugin interface for extending Omnify.

```typescript
interface OmnifyPlugin {
  name: string;
  version: string;

  // Lifecycle hooks
  setup?: (context: PluginContext) => Promise<void>;
  teardown?: () => Promise<void>;

  // Custom types
  types?: CustomTypeDefinition[];

  // Generators
  generators?: GeneratorDefinition[];
}
```

#### `CustomTypeDefinition`
Custom type for extending schema types.

```typescript
interface CustomTypeDefinition {
  name: string;
  typescript: string;
  laravel: string;
  laravelParams?: unknown[];
}
```

### Generator Types

#### `GeneratorDefinition`
Generator definition for creating output files.

```typescript
interface GeneratorDefinition {
  name: string;
  description?: string;
  dependsOn?: string[];
  generate: (ctx: GeneratorContext) => Promise<GeneratorOutput[]>;
}
```

#### `GeneratorContext`
Context passed to generator functions.

```typescript
interface GeneratorContext {
  schemas: SchemaCollection;
  pluginConfig: Record<string, unknown>;
  cwd: string;
  logger: PluginLogger;
  previousOutputs: ReadonlyMap<string, readonly GeneratorOutput[]>;
}
```

#### `GeneratorOutput`
Output file from a generator.

```typescript
interface GeneratorOutput {
  path: string;
  content: string;
  type: GeneratorOutputType;
  metadata?: Record<string, unknown>;
}

type GeneratorOutputType = 'migration' | 'type' | 'model' | 'schema' | 'other';
```

### Config Types

#### `OmnifyConfig`
Configuration options.

```typescript
interface OmnifyConfig {
  schemasDir: string;
  lockFilePath?: string;
  database?: DatabaseConfig;
  output?: OutputConfig;
  plugins?: OmnifyPlugin[];
}
```

## Creating a Plugin

```typescript
import type { OmnifyPlugin } from '@famgia/omnify-types';

const myPlugin: OmnifyPlugin = {
  name: 'my-plugin',
  version: '1.0.0',

  types: [
    {
      name: 'Money',
      typescript: 'number',
      laravel: 'decimal',
      laravelParams: [10, 2],
    },
  ],

  generators: [
    {
      name: 'my-generator',
      dependsOn: ['other-generator'],

      generate: async (ctx) => {
        return [{
          path: 'output/file.ts',
          content: '// Generated',
          type: 'other',
        }];
      },
    },
  ],
};

export default myPlugin;
```

## Built-in Property Types

```typescript
type BuiltInPropertyType =
  // Primitive types
  | 'String'      // VARCHAR(255) / TEXT
  | 'Int'         // INT / INTEGER
  | 'BigInt'      // BIGINT / INTEGER
  | 'Float'       // DOUBLE / REAL
  | 'Decimal'     // DECIMAL(p,s)
  | 'Boolean'     // TINYINT(1) / BOOLEAN / INTEGER

  // Text types
  | 'Text'        // TEXT
  | 'LongText'    // LONGTEXT / TEXT

  // Date/Time types
  | 'Date'        // DATE
  | 'Time'        // TIME
  | 'Timestamp'   // TIMESTAMP

  // Special types
  | 'Json'        // JSON / JSONB / TEXT
  | 'Email'       // VARCHAR(255)
  | 'Password'    // VARCHAR(255)

  // File types
  | 'File'        // VARCHAR(255)
  | 'MultiFile'   // JSON

  // Spatial/Geographic types
  | 'Point'       // POINT / geometry(Point, 4326) - native spatial
  | 'Coordinates' // Two DECIMAL columns (latitude, longitude) - cross-DB

  // Enum type
  | 'Enum'        // ENUM / CREATE TYPE / TEXT

  // Selection types
  | 'Select'      // VARCHAR(255)
  | 'Lookup'      // BIGINT (FK reference)

  // Relationship
  | 'Association' // Foreign key / pivot table
```

## Index Types

```typescript
type IndexType =
  | 'btree'    // Default B-tree index (all dialects)
  | 'hash'     // Hash index (MySQL, PostgreSQL)
  | 'fulltext' // Full-text search (MySQL, PostgreSQL)
  | 'spatial'  // Spatial index (MySQL, PostgreSQL)
  | 'gin'      // GIN index (PostgreSQL only)
  | 'gist'     // GiST index (PostgreSQL only)
```

## Related Packages

- [@famgia/omnify-core](https://www.npmjs.com/package/@famgia/omnify-core) - Core engine
- [@famgia/omnify-cli](https://www.npmjs.com/package/@famgia/omnify-cli) - CLI tool
- [@famgia/omnify-laravel](https://www.npmjs.com/package/@famgia/omnify-laravel) - Laravel generator
- [@famgia/omnify-atlas](https://www.npmjs.com/package/@famgia/omnify-atlas) - Atlas adapter
- [@famgia/omnify-sql](https://www.npmjs.com/package/@famgia/omnify-sql) - Raw SQL generator

## License

MIT
